{"version":3,"file":"Lineage.js","sourceRoot":"","sources":["../../src/Lineage.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  Examples,\n  Feature,\n  GherkinDocument,\n  Pickle,\n  Rule,\n  Scenario,\n  TableRow,\n} from '@cucumber/messages'\n\nexport interface Lineage {\n  gherkinDocument?: GherkinDocument\n  feature?: Feature\n  rule?: Rule\n  scenario?: Scenario\n  examples?: Examples\n  examplesIndex?: number\n  example?: TableRow\n  exampleIndex?: number\n}\n\nexport interface LineageReducer<T> {\n  reduce: (lineage: Lineage, pickle: Pickle) => T\n}\n\nexport type NamingStrategy = LineageReducer<string>\n\nexport enum NamingStrategyLength {\n  LONG = 'LONG',\n  SHORT = 'SHORT',\n}\n\nexport enum NamingStrategyFeatureName {\n  INCLUDE = 'INCLUDE',\n  EXCLUDE = 'EXCLUDE',\n}\n\nexport enum NamingStrategyExampleName {\n  NUMBER = 'NUMBER',\n  PICKLE = 'PICKLE',\n  NUMBER_AND_PICKLE_IF_PARAMETERIZED = 'NUMBER_AND_PICKLE_IF_PARAMETERIZED',\n}\n\nclass BuiltinNamingStrategy implements NamingStrategy {\n  constructor(\n    private readonly length: NamingStrategyLength,\n    private readonly featureName: NamingStrategyFeatureName,\n    private readonly exampleName: NamingStrategyExampleName\n  ) {}\n\n  reduce(lineage: Lineage, pickle: Pickle): string {\n    const parts: string[] = []\n\n    if (lineage.feature?.name && this.featureName === NamingStrategyFeatureName.INCLUDE) {\n      parts.push(lineage.feature.name)\n    }\n\n    if (lineage.rule?.name) {\n      parts.push(lineage.rule.name)\n    }\n\n    if (lineage.scenario?.name) {\n      parts.push(lineage.scenario.name)\n    } else {\n      parts.push(pickle.name)\n    }\n\n    if (lineage.examples?.name) {\n      parts.push(lineage.examples.name)\n    }\n\n    if (lineage.example) {\n      const exampleNumber = [\n        '#',\n        (lineage.examplesIndex ?? 0) + 1,\n        '.',\n        (lineage.exampleIndex ?? 0) + 1,\n      ].join('')\n\n      switch (this.exampleName) {\n        case NamingStrategyExampleName.NUMBER:\n          parts.push(exampleNumber)\n          break\n        case NamingStrategyExampleName.NUMBER_AND_PICKLE_IF_PARAMETERIZED:\n          if (lineage.scenario?.name !== pickle.name) {\n            parts.push(exampleNumber + ': ' + pickle.name)\n          } else {\n            parts.push(exampleNumber)\n          }\n          break\n        case NamingStrategyExampleName.PICKLE:\n          parts.push(pickle.name)\n          break\n      }\n    }\n\n    if (this.length === NamingStrategyLength.SHORT) {\n      return parts.at(-1) as string\n    }\n    return parts.filter((part) => !!part).join(' - ')\n  }\n}\n\nexport function namingStrategy(\n  length: NamingStrategyLength,\n  featureName: NamingStrategyFeatureName = NamingStrategyFeatureName.INCLUDE,\n  exampleName: NamingStrategyExampleName = NamingStrategyExampleName.NUMBER_AND_PICKLE_IF_PARAMETERIZED\n): NamingStrategy {\n  return new BuiltinNamingStrategy(length, featureName, exampleName)\n}\n"]}
import{Kind as e}from"@0no-co/graphql.web";import{k as r,s as t,m as n,C as o,a,b as s,c as u,d as c,e as d,f as l,g as k,h as p}from"./urql-core-chunk.min.mjs";export{i as stringifyVariables}from"./urql-core-chunk.min.mjs";import{toPromise as y,take as h,filter as v,subscribe as f,map as x,tap as m,merge as w,mergeMap as g,takeUntil as b,make as q,onPush as O,share as S,fromPromise as N,fromValue as _,makeSubject as E,lazy as P,onStart as M,switchMap as R,publish as D,takeWhile as A,onEnd as I}from"wonka";var Q=(e,r)=>{if(Array.isArray(e))for(var t=0,n=e.length;t<n;t++)Q(e[t],r);else if("object"==typeof e&&null!==e)for(var i in e)"__typename"===i&&"string"==typeof e[i]?r.add(e[i]):Q(e[i],r);return r},j=r=>{if("definitions"in r){for(var t=[],n=0,i=r.definitions.length;n<i;n++){var o=j(r.definitions[n]);t.push(o)}return{...r,definitions:t}}if("directives"in r&&r.directives&&r.directives.length){for(var a=[],s={},u=0,c=r.directives.length;u<c;u++){var d=r.directives[u],l=d.name.value;"_"!==l[0]?a.push(d):l=l.slice(1),s[l]=d}r={...r,directives:a,_directives:s}}if("selectionSet"in r){var k=[],p=r.kind===e.OPERATION_DEFINITION;if(r.selectionSet){for(var y=0,h=r.selectionSet.selections.length;y<h;y++){var v=r.selectionSet.selections[y];p=p||v.kind===e.FIELD&&"__typename"===v.name.value&&!v.alias;var f=j(v);k.push(f)}return p||k.push({kind:e.FIELD,name:{kind:e.NAME,value:"__typename"},_generated:!0}),{...r,selectionSet:{...r.selectionSet,selections:k}}}}return r},L=new Map,T=e=>{var t=r(e),n=L.get(t.__key);return n||(L.set(t.__key,n=j(t)),Object.defineProperty(n,"__key",{value:t.__key,enumerable:!1})),n};function F(e,r,t){return{...r,kind:e,context:r.context?{...r.context,...t}:t||r.context}}var C=(e,r)=>F(e.kind,e,{meta:{...e.context.meta,...r}}),J=()=>{};function G(n){for(var i=new Map,o=[],a=[],s=Array.isArray(n)?n[0]:n||"",u=1;u<arguments.length;u++){var c=arguments[u];c&&c.definitions?a.push(c):s+=c,s+=arguments[0][u]}a.unshift(r(s));for(var d=0;d<a.length;d++)for(var l=0;l<a[d].definitions.length;l++){var k=a[d].definitions[l];if(k.kind===e.FRAGMENT_DEFINITION){var p=k.name.value,y=t(k);i.has(p)||(i.set(p,y),o.push(k))}else o.push(k)}return r({kind:e.DOCUMENT,definitions:o})}var U=({kind:e})=>"mutation"!==e&&"query"!==e,V=e=>{var r=T(e.query);if(r!==e.query){var t=F(e.kind,e);return t.query=r,t}return e},W=({forward:e,client:r})=>{var t=new Map,i=new Map,o=e=>"query"===e.kind&&"network-only"!==e.context.requestPolicy&&("cache-only"===e.context.requestPolicy||t.has(e.key));return a=>{var s=x((e=>{var i=t.get(e.key),o=i||n(e,{data:null});return o={...o,operation:C(e,{cacheOutcome:i?"hit":"miss"})},"cache-and-network"===e.context.requestPolicy&&(o.stale=!0,$(r,e)),o}))(v((e=>!U(e)&&o(e)))(a)),u=m((e=>{var{operation:n}=e;if(n){var o=n.context.additionalTypenames||[];if("subscription"!==e.operation.kind&&(o=(e=>[...Q(e,new Set)])(e.data).concat(o)),"mutation"===e.operation.kind||"subscription"===e.operation.kind){for(var a=new Set,s=0;s<o.length;s++){var u=o[s],c=i.get(u);for(var d of(c||i.set(u,c=new Set),c.values()))a.add(d);c.clear()}for(var l of a.values())t.has(l)&&(n=t.get(l).operation,t.delete(l),$(r,n))}else if("query"===n.kind&&e.data){t.set(n.key,e);for(var k=0;k<o.length;k++){var p=o[k],y=i.get(p);y||i.set(p,y=new Set),y.add(n.key)}}}}))(e(v((e=>"query"!==e.kind||"cache-only"!==e.context.requestPolicy))(x((e=>C(e,{cacheOutcome:"miss"})))(w([x(V)(v((e=>!U(e)&&!o(e)))(a)),v((e=>U(e)))(a)])))));return w([s,u])}},$=(e,r)=>e.reexecuteOperation(F(r.kind,r,{requestPolicy:"network-only"})),z=new Set,B=(e={})=>{var r=!!e.staleWhileRevalidate,t=!!e.includeExtensions,n={},i=[],a=e=>{i.push(e.operation.key),1===i.length&&Promise.resolve().then((()=>{for(var e;e=i.shift();)n[e]=null}))},s=({client:i,forward:s})=>u=>{var c=e&&"boolean"==typeof e.isClient?!!e.isClient:!i.suspense,d=s(x(V)(v((e=>"teardown"===e.kind||!n[e.key]||!!n[e.key].hasNext||"network-only"===e.context.requestPolicy))(u))),l=x((e=>{var a=((e,r,t)=>({operation:e,data:r.data?JSON.parse(r.data):void 0,extensions:t&&r.extensions?JSON.parse(r.extensions):void 0,error:r.error?new o({networkError:r.error.networkError?new Error(r.error.networkError):void 0,graphQLErrors:r.error.graphQLErrors}):void 0,stale:!1,hasNext:!!r.hasNext}))(e,n[e.key],t);return r&&!z.has(e.key)&&(a.stale=!0,z.add(e.key),$(i,e)),{...a,operation:C(e,{cacheOutcome:"hit"})}}))(v((e=>"teardown"!==e.kind&&!!n[e.key]&&"network-only"!==e.context.requestPolicy))(u));return c?l=m(a)(l):d=m((e=>{var{operation:r}=e;if("mutation"!==r.kind){var i=((e,r)=>{var t={hasNext:e.hasNext};return void 0!==e.data&&(t.data=JSON.stringify(e.data)),r&&void 0!==e.extensions&&(t.extensions=JSON.stringify(e.extensions)),e.error&&(t.error={graphQLErrors:e.error.graphQLErrors.map((e=>e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message))},e.error.networkError&&(t.error.networkError=""+e.error.networkError)),t})(e,t);n[r.key]=i}}))(d),w([d,l])};return s.restoreData=e=>{for(var r in e)null!==n[r]&&(n[r]=e[r])},s.extractData=()=>{var e={};for(var r in n)null!=n[r]&&(e[r]=n[r]);return e},e&&e.initialState&&s.restoreData(e.initialState),s},H=({forwardSubscription:e,enableAllOperations:r,isSubscriptionOperation:t})=>({client:i,forward:o})=>{var c=t||(e=>"subscription"===e.kind||!!r&&("query"===e.kind||"mutation"===e.kind));return r=>{var t=g((t=>{var{key:o}=t,c=v((e=>"teardown"===e.kind&&e.key===o))(r);return b(c)((r=>{var t=e(a(r),r);return q((e=>{var o,a,c=!1;function d(t){e.next(a=a?u(a,t):n(r,t))}return Promise.resolve().then((()=>{c||(o=t.subscribe({next:d,error(t){Array.isArray(t)?d({errors:t}):e.next(s(r,t)),e.complete()},complete(){c||(c=!0,"subscription"===r.kind&&i.reexecuteOperation(F("teardown",r,r.context)),a&&a.hasNext&&d({hasNext:!1}),e.complete())}}))})),()=>{c=!0,o&&o.unsubscribe()}}))})(t))}))(v((e=>"teardown"!==e.kind&&c(e)))(r)),d=o(v((e=>"teardown"===e.kind||!c(e)))(r));return w([t,d])}},K=({forward:e})=>r=>e(r),X=({forward:e})=>r=>{var t=g((e=>{var t=a(e),n=c(e,t),i=d(e,t);return b(v((r=>"teardown"===r.kind&&r.key===e.key))(r))(l(e,n,i))}))(v((e=>"teardown"!==e.kind&&("subscription"!==e.kind||!!e.context.fetchSubscriptions)))(r)),n=e(v((e=>"teardown"===e.kind||"subscription"===e.kind&&!e.context.fetchSubscriptions))(r));return w([t,n])},Y=e=>({client:r,forward:t})=>e.reduceRight(((e,t)=>t({client:r,forward:r=>S(e(S(r))),dispatchDebug(e){}})),t),Z=({onOperation:e,onResult:r,onError:t})=>({forward:n})=>i=>g((e=>{t&&e.error&&t(e.error,e.operation);var n=r&&r(e)||e;return"then"in n?N(n):_(n)}))(n(g((r=>{var t=e&&e(r)||r;return"then"in t?N(t):_(t)}))(i))),ee=({})=>e=>v((e=>!1))(e),re=function e(r){var t=0,n=new Map,i=new Map,o=new Set,a=[],s={url:r.url,fetchSubscriptions:r.fetchSubscriptions,fetchOptions:r.fetchOptions,fetch:r.fetch,preferGetMethod:r.preferGetMethod,requestPolicy:r.requestPolicy||"cache-first"},u=E();function c(e){"mutation"!==e.kind&&"teardown"!==e.kind&&o.has(e.key)||("teardown"===e.kind?o.delete(e.key):"mutation"!==e.kind&&o.add(e.key),u.next(e))}var d=!1;function l(e){if(e&&c(e),!d){for(d=!0;d&&(e=a.shift());)c(e);d=!1}}var k=e=>{var r=b(v((r=>"teardown"===r.kind&&r.key===e.key))(u.source))(v((r=>r.operation.kind===e.kind&&r.operation.key===e.key&&(!r.operation.context._instance||r.operation.context._instance===e.context._instance)))(Q));return r="query"!==e.kind?A((e=>!!e.hasNext),!0)(r):R((r=>{var t=_(r);return r.stale||r.hasNext?t:w([t,x((()=>(r.stale=!0,r)))(h(1)(v((r=>r.key===e.key))(u.source)))])}))(r),r="mutation"!==e.kind?I((()=>{o.delete(e.key),n.delete(e.key),i.delete(e.key),d=!1;for(var r=a.length-1;r>=0;r--)a[r].key===e.key&&a.splice(r,1);c(F("teardown",e,e.context))}))(O((r=>{if(r.stale)if(r.hasNext)for(var t=0;t<a.length;t++){var i=a[t];if(i.key===r.operation.key){o.delete(i.key);break}}else o.delete(e.key);else r.hasNext||o.delete(e.key);n.set(e.key,r)}))(r)):M((()=>{c(e)}))(r),S(r)},m=this instanceof e?this:Object.create(e.prototype),g=Object.assign(m,{suspense:!!r.suspense,operations$:u.source,reexecuteOperation(e){if("teardown"===e.kind)l(e);else if("mutation"===e.kind)a.push(e),Promise.resolve().then(l);else if(i.has(e.key)){for(var r=!1,t=0;t<a.length;t++)a[t].key===e.key&&(a[t]=e,r=!0);r||o.has(e.key)&&"network-only"!==e.context.requestPolicy?(o.delete(e.key),Promise.resolve().then(l)):(a.push(e),Promise.resolve().then(l))}},createRequestOperation:(e,r,n)=>(n||(n={}),F(e,r,{_instance:"mutation"===e?t=t+1|0:void 0,...s,...n,requestPolicy:n.requestPolicy||s.requestPolicy,suspense:n.suspense||!1!==n.suspense&&g.suspense})),executeRequestOperation:e=>{return r="mutation"===e.kind?k(e):P((()=>{var r=i.get(e.key);r||i.set(e.key,r=k(e)),r=M((()=>{l(e)}))(r);var t=n.get(e.key);return"query"===e.kind&&t&&(t.stale||t.hasNext)?R(_)(w([r,v((r=>r===n.get(e.key)))(_(t))])):r})),(t=e=>r(e)).toPromise=()=>y(h(1)(v((e=>!e.stale&&!e.hasNext))(t))),t.then=(e,r)=>t.toPromise().then(e,r),t.subscribe=e=>f(e)(t),t;var r,t},executeQuery(e,r){var t=g.createRequestOperation("query",e,r);return g.executeRequestOperation(t)},executeSubscription(e,r){var t=g.createRequestOperation("subscription",e,r);return g.executeRequestOperation(t)},executeMutation(e,r){var t=g.createRequestOperation("mutation",e,r);return g.executeRequestOperation(t)},readQuery(e,r,t){var n=null;return f((e=>{n=e}))(g.query(e,r,t)).unsubscribe(),n},query:(e,r,t)=>g.executeQuery(p(e,r),t),subscription:(e,r,t)=>g.executeSubscription(p(e,r),t),mutation:(e,r,t)=>g.executeMutation(p(e,r),t)}),q=J,N=Y(r.exchanges),Q=S(N({client:g,dispatchDebug:q,forward:ee({dispatchDebug:q})})(u.source));return D(Q),g},te=re;export{re as Client,o as CombinedError,W as cacheExchange,Y as composeExchanges,te as createClient,p as createRequest,K as debugExchange,Z as errorExchange,X as fetchExchange,T as formatDocument,G as gql,s as makeErrorResult,F as makeOperation,n as makeResult,Z as mapExchange,u as mergeResultPatch,B as ssrExchange,t as stringifyDocument,H as subscriptionExchange};
//# sourceMappingURL=urql-core.min.mjs.map
